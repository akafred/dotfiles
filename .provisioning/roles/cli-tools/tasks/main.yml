- name: install common tools with {{ ansible_pkg_mgr }}
  become: "{{ ansible_system != 'Darwin' }}"
  package:
    name: "{{ item }}"
  with_items:
   - tree
   - wget
   - autojump
   - "{{ 'ag' if (ansible_pkg_mgr == 'Homebrew') else 'the_silver_searcher' }}"

- name: patch autojump with zsh-file on rhel
  copy:
    src: autojump.zsh
    dest: /usr/share/autojump/autojump.zsh
    mode: 0644
  become: true
  when: ansible_system != 'Darwin'

- name: make sure we have autojump sourced
  blockinfile:
    dest: "{{ ansible_env.HOME }}/.paths_homes_etc"
    insertafter: EOF
    marker: "# {mark} ANSIBLE MANAGED BLOCK for autojump"
    content: |
             source /usr/share/autojump/autojump.zsh
  when: ansible_system != 'Darwin'

- name: install mtr
  become: "{{ ansible_system != 'Darwin' }}"
  package:
    name: mtr
  when: ansible_system != 'Darwin'

- name: install mtr
  homebrew:
    name: mtr
  when: ansible_system == 'Darwin'

# need to link mtr into /usr/local/bin
- name: need to link mtr into /usr/local/bin
  file: src=/usr/local/sbin/mtr dest=/usr/local/bin/mtr state=link mode=0755

- name: need to link mtr-packet into /usr/local/bin
  file: src=/usr/local/sbin/mtr-packet dest=/usr/local/bin/mtr-packet state=link mode=0755

- name: tldr repo
  homebrew_tap:
    name: tldr-pages/tldr
  when: ansible_system == "Darwin"

- name: install tldr
  homebrew:
    name: tldr
  when: ansible_system == "Darwin"

- name: install multiplexers
  homebrew:
    name:
      - tmux
      - csshX
  when: ansible_system == "Darwin"

- name: install thefuck
  package:
    name: thefuck

- name: fix thefuck
  become: "{{ ansible_system != 'Darwin' }}"
  blockinfile:
    dest: "{{ ansible_env.HOME }}/.paths_homes_etc"
    insertafter: EOF
    marker: "# {mark} ANSIBLE MANAGED BLOCK for thefuck"
    content: |
             eval $(thefuck --alias)

- name: install thefuck
  become: "{{ ansible_system != 'Darwin' }}"
  package:
    name: thefuck

- name: install more tools
  become: "{{ ansible_system != 'Darwin' }}"
  package:
    name: "{{ item }}"
  with_items:
    - fzf
    - httpie
    - yq
    - bat
    - shellcheck
    - gh
